- route:
    from:
      uri: "dapr-pubsub:sensors/iot"
      steps:
        - to: "log:from-pubsub"
        - choice:
            when:
              - jq: '.source == "sensor-1"'
                steps:
                - to: "log:sensor-1"
                - transform:
                    jq: '.data'
                - transform:
                    wasm: "quay.io/lburgazzoli/camel-go-wasm:latest?etc/wasm/fn/to_upper.wasm"
                - to: "dapr-pubsub:sensors/near"
                - to: "log:near"
              - jq: '.source == "sensor-2"'
                steps:
                  - to: "log:sensor-2"
                  - transform:
                      jq: '.data'
                  - transform:
                      wasm: "quay.io/lburgazzoli/camel-go-wasm:latest?etc/wasm/fn/to_lower.wasm"
                  - to: "dapr-pubsub:sensors/far"
                  - to: "log:far"
            otherwise:
              steps:
                - to: "log:unknown"
